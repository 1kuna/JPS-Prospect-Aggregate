import{u as o,r as t,j as e,A as v,a as E,b,B as d,D as N,c as A,d as K,e as L,g as R,h as F,f as T}from"./index-dQOyprAW.js";import{P as x,D as O}from"./DataTable-C8yno1Iu.js";const P=a=>a.dataSources,U=a=>a.loading.dataSources,w=a=>a.errors.dataSources,B=a=>a.fetchDataSources,M=a=>a.createDataSource,z=a=>a.updateDataSource;function q(){const a=o(P),u=o(U),l=o(w),i=o(B),D=o(M),g=o(z),[m,n]=t.useState(!1),[c,h]=t.useState(null),S=t.useRef(!1);t.useEffect(()=>{S.current||(console.log("DataSources component mounted, fetching data sources..."),i().then(()=>{console.log("Data sources fetched successfully in component")}).catch(s=>{console.error("Error fetching data sources in component:",s)}),S.current=!0)},[i]),t.useEffect(()=>{console.log("DataSources component state:",{dataSources:a,loading:u,errors:l})},[a,u,l]);const f=t.useCallback(()=>{i()},[i]),p=t.useCallback(async s=>{try{await D(s),n(!1)}catch(r){console.error("Failed to create data source:",r)}},[D]),j=t.useCallback(async s=>{try{await g(String(s.id),s),n(!1),h(null)}catch(r){console.error("Failed to update data source:",r)}},[g]),C=t.useCallback(s=>{h(s),n(!0)},[]),y=t.useCallback(()=>{n(!1),h(null)},[]);if(u&&!a.length)return e.jsx(x,{title:"Data Sources",isLoading:!0,children:e.jsx("div",{children:"Loading data sources..."})});if(l&&!a.length)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Data Sources"}),e.jsxs(v,{variant:"destructive",children:[e.jsx(E,{children:"Error loading data sources"}),e.jsx(b,{children:l.message})]}),e.jsx(d,{onClick:f,children:"Retry"})]});const k=[{header:"Name",accessorKey:"name"},{header:"URL",accessorKey:"url"},{header:"Status",accessorKey:"status"},{header:"Last Checked",accessorKey:s=>s.lastChecked?T(s.lastChecked):"Never"},{header:"Proposals",accessorKey:s=>{var r;return((r=s.proposalCount)==null?void 0:r.toString())||"0"}},{header:"Actions",accessorKey:"id",cell:s=>e.jsx("div",{className:"flex space-x-2",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>C(s),children:"Edit"})})}];return e.jsx(x,{title:"Data Sources",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-muted-foreground",children:[a.length," data sources configured"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:f,children:"Refresh"}),e.jsxs(N,{open:m,onOpenChange:n,children:[e.jsx(A,{asChild:!0,children:e.jsx(d,{children:"Add Data Source"})}),e.jsxs(K,{children:[e.jsx(L,{children:e.jsx(R,{children:c?"Edit Data Source":"Add Data Source"})}),e.jsx(F,{initialData:c?{id:c.id,name:c.name,url:c.url,description:c.description}:void 0,onSubmit:s=>{c?j({...s,id:c.id}):p(s)},onCancel:y})]})]})]})]}),e.jsx(O,{data:a,columns:k,emptyMessage:"No data sources configured"})]})})}export{q as default};
