import{u as r,r as t,j as e,A as v,a as b,b as N,B as g,D as L,c as A,d as K,e as R,g as F,h as I,f as T}from"./index-Cz8ctbBY.js";import{P as m,D as O}from"./DataTable-C9j0YDu_.js";const P=s=>s.dataSources,U=s=>s.loading.dataSources,w=s=>s.errors.dataSources,B=s=>s.fetchDataSources,M=s=>s.createDataSource,z=s=>s.updateDataSource;function G(){const s=r(P),d=r(U),u=r(w),h=r(B),f=r(M),S=r(z),[p,n]=t.useState(!1),[c,D]=t.useState(null),[l,i]=t.useState(!0);t.useEffect(()=>(console.log("DataSources component mounted, fetching data sources..."),h().then(()=>{console.log("Data sources fetched successfully in component"),i(!1)}).catch(a=>{console.error("Error fetching data sources in component:",a),i(!1)}),()=>{console.log("DataSources component unmounting")}),[h]),t.useEffect(()=>{console.log("DataSources component state:",{dataSources:s,loading:d,errors:u,isInitialLoad:l})},[s,d,u,l]);const x=t.useCallback(()=>{console.log("Manually refreshing data sources..."),i(!0),h().then(()=>{console.log("Data sources refreshed successfully"),i(!1)}).catch(a=>{console.error("Error refreshing data sources:",a),i(!1)})},[h]),j=t.useCallback(async a=>{try{await f(a),n(!1)}catch(o){console.error("Failed to create data source:",o)}},[f]),y=t.useCallback(async a=>{try{await S(String(a.id),a),n(!1),D(null)}catch(o){console.error("Failed to update data source:",o)}},[S]),C=t.useCallback(a=>{D(a),n(!0)},[]),k=t.useCallback(()=>{n(!1),D(null)},[]);if((l||d)&&!s.length)return e.jsx(m,{title:"Data Sources",isLoading:!0,children:e.jsx("div",{children:"Loading data sources..."})});if(u&&!l&&!s.length)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Data Sources"}),e.jsxs(v,{variant:"destructive",children:[e.jsx(b,{children:"Error loading data sources"}),e.jsx(N,{children:u.message})]}),e.jsx(g,{onClick:x,children:"Retry"})]});const E=[{header:"Name",accessorKey:"name"},{header:"URL",accessorKey:"url"},{header:"Status",accessorKey:"status"},{header:"Last Checked",accessorKey:a=>a.lastChecked?T(a.lastChecked):"Never"},{header:"Proposals",accessorKey:a=>{var o;return((o=a.proposalCount)==null?void 0:o.toString())||"0"}},{header:"Actions",accessorKey:"id",cell:a=>e.jsx("div",{className:"flex space-x-2",children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>C(a),children:"Edit"})})}];return e.jsx(m,{title:"Data Sources",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-muted-foreground",children:[s.length," data sources configured"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:x,children:"Refresh"}),e.jsxs(L,{open:p,onOpenChange:n,children:[e.jsx(A,{asChild:!0,children:e.jsx(g,{children:"Add Data Source"})}),e.jsxs(K,{children:[e.jsx(R,{children:e.jsx(F,{children:c?"Edit Data Source":"Add Data Source"})}),e.jsx(I,{initialData:c?{id:c.id,name:c.name,url:c.url,description:c.description}:void 0,onSubmit:a=>{c?y({...a,id:c.id}):j(a)},onCancel:k})]})]})]})]}),e.jsx(O,{data:s,columns:E,emptyMessage:"No data sources configured",isLoading:d||l})]})})}export{G as default};
